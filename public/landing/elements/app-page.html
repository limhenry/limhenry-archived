<dom-module id="app-page">
    <template>
        <style>
        :host {
            display: block;
            --primary-background-color: #E91E63;
            --secondary-background-color: #ECEFF1;
            --tertiary-background-color: #F50057;
            --highlight-background-color: #E64A19;
            --primary-text-color: rgba(255, 255, 255, 0.9);
            --secondary-text-color: rgba(255, 255, 255, 1);
            --tertiary-text-color: rgba(0, 0, 0, 0.8);
            --icon-background-color: rgba(255, 255, 255, 1);
            --paper-tab-ink: #fff;
            --paper-tab-color: #fff;
            color: var(--primary-text-color);
        }
        
        app-header-layout {
            background: var(--primary-background-color);
            --primary-text-color: rgba(0, 0, 0, 0.8);
        }
        
        app-toolbar {
            margin: 0 auto;
            max-width: 1400px;
            height: 200px;
        }
        
        app-toolbar [title] {
            font-size: 1.8em;
            font-weight: 300;
            margin-left: 24px;
        }
        
        paper-tabs {
            margin-left: 16px;
            width: 450px;
            --paper-tabs-selection-bar-color: var(--paper-tab-color);
        }
        
        paper-toolbar {
            background: var(--primary-background-color);
        }
        
        paper-item {
            color: rgba(0,0,0,1);
        }
        
        #app-toolbar {
            position: relative;
            height: 168px;
            background: var(--primary-background-color);
        }
        
        #app-toolbar .bottom {
            position: absolute;
            bottom: 0;
            right: 0;
            left: 0;
            padding: 0 16px;
            height: 48px;
        }
        
        @media screen and (max-width: 840px) {
            app-toolbar {
                height: 64px;
                background: var(--primary-background-color);
            }
            app-toolbar [title] {
                font-size: 20px;
                font-weight: 400;
                margin-left: 12px;
                color: var(--secondary-text-color);
            }
        }
        </style>
        <paper-toast text="Tim Cook Mode Activated." id="easter"></paper-toast>
        <iron-media-query query="(min-width: 840px)" query-matches="{{wide}}" on-query-matches-changed="_onQueryChangeds"></iron-media-query>
        <app-drawer-layout force-narrow>
            <template is="dom-if" if="{{!wide}}">
                <app-drawer id="drawer" swipe-open>
                    <div id="app-toolbar">
                        <div class="bottom drawer-text">
                            <div>Henry Lim</div>
                            <div>limhenry.xyz</div>
                        </div>
                    </div>
                    <iron-selector attr-for-selected="id" selected="{{data.page}}">
                        <paper-item id="" drawer-toggle on-tap="scrollTop">Home</paper-item>
                        <paper-item id="project" drawer-toggle on-tap="scrollTop">Project</paper-item>
                        <paper-item id="contact" drawer-toggle on-tap="scrollTop">Contact</paper-item>
                        <paper-item id="resources" drawer-toggle on-tap="scrollTop">Resources</paper-item>
                    </iron-selector>
                </app-drawer>
            </template>
            <app-drawer id="drawer"></app-drawer>
            <app-header-layout id="appHeaderLayout">
                <template is="dom-if" if="{{!wide}}">
                    <app-header reveals effects="waterfall fade-background">
                        <app-toolbar wide-layout$="{{wide}}">
                            <template is="dom-if" if="{{!wide}}">
                                <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                                <div title>limhenry.xyz</div>
                            </template>
                        </app-toolbar>
                    </app-header>
                </template>
                <template is="dom-if" if="{{wide}}">
                    <app-header effects="waterfall fade-background">
                        <app-toolbar wide-layout$="{{wide}}">
                            <template is="dom-if" if="{{!wide}}">
                                <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                                <div title>limhenry.xyz</div>
                            </template>
                            <template is="dom-if" if="{{wide}}">
                                <div title>limhenry.xyz</div>
                                <paper-tabs attr-for-selected="id" selected="{{data.page}}" bottom-item>
                                    <paper-tab id="" on-tap="scrollTop">HOME</paper-tab>
                                    <paper-tab id="project" on-tap="scrollTop">PROJECT</paper-tab>
                                    <paper-tab id="contact" on-tap="scrollTop">CONTACT</paper-tab>
                                    <paper-tab id="resources" on-tap="scrollTop">RESOURCES</paper-tab>
                                </paper-tabs>
                            </template>
                        </app-toolbar>
                    </app-header>
                </template>
                <div id="appContent">
                    <carbon-location route="{{route}}"></carbon-location>
                    <carbon-route route="{{route}}" pattern="/:page" data="{{data}}"></carbon-route>
                    <neon-animated-pages class="flex" attr-for-selected="id" selected="{{data.page}}" fallback-selection="404">
                        <home-page id="" class="home"></home-page>
                        <project-page id="project"></project-page>
                        <contact-page id="contact"></contact-page>
                        <resources-page id="resources"></resources-page>
                    </neon-animated-pages>
                </div>
            </app-header-layout>
        </app-drawer-layout>

        <platinum-sw-register auto-register
                              clients-claim
                              skip-waiting
                              on-service-worker-installed="displayInstalledToast">
          <platinum-sw-cache default-cache-strategy="fastest"
                             cache-config-file="/cache-config.json">
          </platinum-sw-cache>
        </platinum-sw-register>

    </template>
    <script>
    Polymer({
        is: 'app-page',
        properties: {
            route: {
                type: Object,
                notify: true,
                observer: "_onDataChanged"
            },
            data: {
                type: Object,
                value: {
                    page: '/home/'
                },
                notify: true

            }
        },
        ready: function() {
            this.async(function() {
                if (!this.route.path && this.route.path == "/") {
                    this.set('route.path', '/');
                }
            }, 1);
        },
        displayInstalledToast: function(){
            console.log("offline liao")
        },
        _onQueryChangeds: function() {
            var div = this.$.appContent;
            if (this.wide == false) {
                div.style.paddingTop = "200px";
            }
            if (this.wide == true) {
                div.style.paddingTop = "0px"
            }
        },
        scrollTop: function() {
            document.body.scrollTop = "0";
        },
        _onDataChanged: function() {

            if (this.data.page == "") {
                if (!Polymer.isInstance(this.querySelector('home-page'))) {
                    Polymer.Base.importHref(
                        '/elements/home-page.html', () => {}, () => {}, true
                    );
                };
            }

            if (this.data.page == "project") {
                if (!Polymer.isInstance(this.$.project)) {
                    Polymer.Base.importHref(
                        '/elements/project-page.html', () => {}, () => {}, true
                    );
                }
            };

            if (this.data.page == "contact") {
                if (!Polymer.isInstance(this.$.contact)) {
                    Polymer.Base.importHref(
                        '/elements/contact-page.html', () => {}, () => {}, true
                    );
                }
            };

            if (this.data.page == "resources") {
                if (!Polymer.isInstance(this.$.resources)) {
                    Polymer.Base.importHref(
                        '/elements/resources-page.html', () => {}, () => {}, true
                    );
                }
            };

            if (this.route.path == "/404") {
                window.location.replace('/404/')
            }
        },
        rosegold: function(){
            this.customStyle['--primary-background-color'] = '#E6C1BE';
            this.customStyle['--secondary-background-color'] = '#EAC4C1';
            this.customStyle['--tertiary-background-color'] = '#EAC4C1';
            this.customStyle['--primary-text-color'] = 'rgba(0, 0, 0, 0.9)';
            this.customStyle['--secondary-text-color'] = 'rgba(0, 0, 0, 0.9)';
            this.customStyle['--icon-background-color'] = 'rgba(0, 0, 0, 0.7)';
            document.querySelector('.home').$.avatar.src="/img/profile-rose.webp";
            this.updateStyles();
            this.$.easter.toggle();
        }
    });
    </script>
</dom-module>
