<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">

<!--
`carbon-route` is an element that enables declarative, self-describing routing
for a web app.

> *n.b. carbon-route is still in beta. We expect it will need some changes. We're counting on your feedback!*

In its typical usage, a `carbon-route` element consumes an object that describes
some state about the current route, via the `route` property. It then parses
that state using the `pattern` property, and produces two artifacts: some `data`
related to the `route`, and a `tail` that contains the rest of the `route` that
did not match.

Here is a basic example, when used with `carbon-location`:

    <carbon-location route="{{route}}"></carbon-location>
    <carbon-route
        route="{{route}}"
        pattern="/:page"
        data="{{data}}"
        tail="{{tail}}">
    </carbon-route>

In the above example, the `carbon-location` produces a `route` value. Then, the
`route.path` property is matched by comparing it to the `pattern` property. If
the `pattern` property matches `route.path`, the `carbon-route` will set or update
its `data` property with an object whose properties correspond to the parameters
in `pattern`. So, in the above example, if `route.path` was `'/about'`, the value
of `data` would be `{"page": "about"}`.

The `tail` property represents the remaining part of the route state after the
`pattern` has been applied to a matching `route`.

Here is another example, where `tail` is used:

    <carbon-location route="{{route}}"></carbon-location>
    <carbon-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}">
    </carbon-route>
    <carbon-route
        route="{{subroute}}"
        pattern="/:id"
        data="{{subrouteData}}">
    </carbon-route>

In the above example, there are two `carbon-route` elements. The first
`carbon-route` consumes a `route`. When the `route` is matched, the first
`carbon-route` also produces `routeData` from its `data`, and `subroute` from
its `tail`. The second `carbon-route` consumes the `subroute`, and when it
matches, it produces an object called `subrouteData` from its `tail`.

So, when `route.path` is `'/about'`, the `routeData` object will look like
this: `{ page: 'about' }`

And `subrouteData` will be null. However, if `route.path` changes to
`'/article/123'`, the `routeData` object will look like this:
`{ page: 'article' }`

And the `subrouteData` will look like this: `{ id: '123' }`

`carbon-route` is responsive to bi-directional changes to the `data` objects
they produce. So, if `routeData.page` changed from `'article'` to `'about'`,
the `carbon-route` will update `route.path`. This in-turn will update the
`carbon-location`, and cause the global location bar to change its value.

@element carbon-route
@demo demo/index.html
-->

<script>"use strict";Polymer({is:"carbon-route",properties:{route:{type:Object,notify:!0},pattern:{type:String},data:{type:Object,value:function(){return{}},notify:!0},queryParams:{type:Object,value:function(){return{}},notify:!0},tail:{type:Object,value:function(){return{path:null,prefix:null,__queryParams:null}},notify:!0},active:{type:Boolean,notify:!0,readOnly:!0},_skipMatch:{type:Boolean,value:!1},_matched:{type:String,value:""}},observers:["__tryToMatch(route.path, pattern)","__updatePathOnDataChange(data.*)","__tailPathChanged(tail.path)","__routeQueryParamsChanged(route.__queryParams)","__tailQueryParamsChanged(tail.__queryParams)","__queryParamsChanged(queryParams.*)"],created:function(){this.linkPaths("route.__queryParams","tail.__queryParams"),this.linkPaths("tail.__queryParams","route.__queryParams")},__assign:function(t,a){if(null!=a)for(var i in a)t[i]=a[i];return t},__routeQueryParamsChanged:function(t){if(t&&this.tail){if(this.set("tail.__queryParams",t),!this.active||this._skipMatch)return;this._skipMatch=!0;var a;a=Object.assign?Object.assign({},t):this.__assign({},t),this.set("queryParams",a),this._skipMatch=!1}},__tailQueryParamsChanged:function(t){t&&this.route&&this.set("route.__queryParams",t)},__queryParamsChanged:function(t){this.active&&!this._skipMatch&&this.set("route.__"+t.path,t.value)},__resetProperties:function(){this._setActive(!1),this._matched=null},__tryToMatch:function(t,a){if(!this._skipMatch&&a){if(!t)return void this.__resetProperties();for(var i=t.split("/"),e=a.split("/"),r=[],s={},h=0;h<e.length;h++){var n=e[h];if(!n&&""!==n)break;var _=i.shift();if(!_&&""!==_)return void this.__resetProperties();if(r.push(_),":"==n.charAt(0))s[n.slice(1)]=_;else if(n!==_)return void this.__resetProperties()}r=r.join("/");var u=i.join("/");i.length>0&&(u="/"+u),this._skipMatch=!0,this._matched=r,this.data=s;var o=this.route.prefix+r;this.tail&&this.tail.prefix===o&&this.tail.path===u||(this.tail={prefix:o,path:u,__queryParams:this.route.__queryParams}),this._setActive(!0),this._skipMatch=!1}},__tailPathChanged:function(t){if(this.active&&!this._skipMatch){var a=this._matched;t&&("/"!==t.charAt(0)&&(t="/"+t),a+=t),this.set("route.path",a)}},__updatePathOnDataChange:function(){this.route&&!this._skipMatch&&this.active&&(this._skipMatch=!0,this.tail={path:null,prefix:null,queryParams:null},this.set("route.path",this.__getLink({})),this._skipMatch=!1)},__getLink:function(t){var a={tail:this.tail};for(var i in this.data)a[i]=this.data[i];for(var i in t)a[i]=t[i];var e=this.pattern.split("/"),r=e.map(function(t){return":"==t[0]&&(t=a[t.slice(1)]),t},this);return a.tail&&a.tail.path&&r.push(a.tail.path),r.join("/")}});</script>
