<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">

<!--

The `iron-location` element manages binding to and from the current URL.

iron-location is the first, and lowest level element in the Polymer team's
routing system. This is a beta release of iron-location as we continue work
on higher level elements, and as such iron-location may undergo breaking
changes.

#### Properties

When the URL is: `/search?query=583#details` iron-location's properties will be:

  - path: `'/search'`
  - query: `'query=583'`
  - hash: `'details'`

These bindings are bidirectional. Modifying them will in turn modify the URL.

iron-location is only active while it is attached to the document.

#### Links

While iron-location is active in the document it will intercept clicks on links
within your site, updating the URL pushing the updated URL out through the
databinding system. iron-location only intercepts clicks with the intent to
open in the same window, so middle mouse clicks and ctrl/cmd clicks work fine.

You can customize this behavior with the `urlSpaceRegex`.

#### Dwell Time

iron-location protects against accidental history spamming by only adding
entries to the user's history if the URL stays unchanged for `dwellTime`
milliseconds.

@demo demo/index.html

 -->
<script>"use strict";Polymer({is:"iron-location",properties:{path:{type:String,notify:!0,value:function(){return window.location.pathname}},query:{type:String,notify:!0,value:function(){return window.location.search.slice(1)}},hash:{type:String,notify:!0,value:function(){return window.location.hash.slice(1)}},dwellTime:{type:Number,value:2e3},urlSpaceRegex:{type:String,value:""},_urlSpaceRegExp:{computed:"_makeRegExp(urlSpaceRegex)"},_lastChangedAtAt:{type:Number,value:-(1/0)},_initialized:{type:Boolean,value:!1}},hostAttributes:{hidden:!0},observers:["_updateUrl(path, query, hash)"],attached:function(){this.listen(window,"hashchange","_hashChanged"),this.listen(window,"location-changed","_urlChanged"),this.listen(window,"popstate","_urlChanged"),this.listen(document.body,"click","_globalOnClick"),this._urlChanged(),this._initialized=!0},detached:function(){this.unlisten(window,"hashchange","_hashChanged"),this.unlisten(window,"location-changed","_urlChanged"),this.unlisten(window,"popstate","_urlChanged"),this.unlisten(document.body,"click","_globalOnClick"),this._initialized=!1},_now:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},_hashChanged:function(){this.hash=window.location.hash.substring(1)},_urlChanged:function(){this._dontUpdateUrl=!0,this._hashChanged(),this.path=window.location.pathname,this.query=window.location.search.substring(1),this._dontUpdateUrl=!1,this._updateUrl()},_getUrl:function(){var t=this.path,n=this.query;return n&&(t+="?"+n),this.hash&&(t+="#"+this.hash),t},_updateUrl:function(){if(!this._dontUpdateUrl&&this._initialized){var t=this._getUrl(),n=window.location.pathname+window.location.search+window.location.hash;if(t!=n){var i=this._now(),e=this._lastChangedAt+this.dwellTime>i;this._lastChangedAt=i,e?window.history.replaceState({},"",t):window.history.pushState({},"",t),this.fire("location-changed",{},{node:window})}}},_globalOnClick:function(t){var n=this._getSameOriginLinkHref(t);n&&(window.history.pushState({},"",n),this.fire("location-changed",{},{node:window}),t.preventDefault())},_getSameOriginLinkHref:function(t){if(0!==t.button)return null;if(t.metaKey||t.ctrlKey)return null;for(var n=Polymer.dom(t).path,i=null,e=0;e<n.length;e++){var a=n[e];if("A"===a.tagName&&a.href){i=a.href;break}}if(!i)return null;var o;o=null!=document.baseURI?new URL(i,document.baseURI):new URL(i);var h;if(window.location.origin?h=window.location.origin:(h=window.location.protocol+"//"+window.location.hostname,window.location.port&&(h+=":"+window.location.port)),o.origin!==h)return null;var r=o.pathname+o.search+o.hash;return this._urlSpaceRegExp&&!this._urlSpaceRegExp.test(r)?null:r},_makeRegExp:function(t){return RegExp(t)}});</script>
